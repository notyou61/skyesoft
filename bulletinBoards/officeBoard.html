<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Office Bulletin Board</title>
<link rel="icon" href="/skyesoft/assets/images/favicon.ico" type="image/x-icon">
<style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100vh;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:url('/skyesoft/assets/images/background.jpg') no-repeat center center fixed;background-size:cover;display:flex;flex-direction:column;align-items:center}
    .board-section{width:90vw;max-width:1200px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);padding:8px 16px}
    #pageHeader,#pageFooter{flex-shrink:0}
    #pageBody{flex-grow:1;display:flex;flex-direction:column;justify-content:space-between;margin:12px 0;max-height:calc(100vh - 160px);overflow:hidden}
    #pageHeader{display:flex;justify-content:space-between;align-items:center;font-size:1.1em;margin-top:12px}
    #bodyHeader,#bodyFooter{font-weight:bold;font-size:1em;text-align:left;margin-bottom:8px}
    #bodyMain{flex-grow:1;display:flex;flex-direction:column;justify-content:flex-start;overflow:hidden;margin-top:-4px}
    .entry{margin:6px 0;font-size:1.05em}
    #pageFooter{display:flex;justify-content:space-between;align-items:center;font-size:0.8em;padding:6px 12px;background:#fff;margin-bottom:12px}
    .cardBody{overflow-y:auto;max-height:60vh;flex-grow:1;padding-top:0;margin-top:0}
    .bodyHeader::after{content:"";display:block;height:2px;width:100%;background:#ccc;margin-top:6px}
    .bodyFooter::before{content:"";display:block;height:2px;width:100%;background:#ccc;margin-bottom:6px}
    .version{font-size:0.8em;color:#777}
    .forecastRow{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .forecastItem{flex:1;font-size:0.8rem;min-width:200px;background:#f9f9f9;padding:10px;border-radius:8px;margin:4px 0}
    .permitCard{max-height:500px;overflow:hidden;width:100%}
    .scrollContainer{max-height:400px;overflow-y:auto;position:relative;width:100%}
    .permitTable{width:100%;border-collapse:collapse;table-layout:auto}
    .permitTable thead{position:sticky;top:0;background:#004080;color:#fff;z-index:2}
    .permitTable th,.permitTable td{padding:6px 8px;border-bottom:1px solid #ddd;text-align:left}
    .permitTable th:nth-child(1),td:nth-child(1){width:10%}
    .permitTable th:nth-child(2),td:nth-child(2){width:25%}
    .permitTable th:nth-child(3),td:nth-child(3){width:25%}
    .permitTable th:nth-child(4),td:nth-child(4){width:15%}
    .permitTable th:nth-child(5),td:nth-child(5){width:10%}
    .permitTable th:nth-child(6),td:nth-child(6){width:15%;white-space:normal}
    .permitTable tr:nth-child(even){background:#f2f2f2}
    .status-ready{color:green;font-weight:bold}
</style>
</head>
<body>
<div class="board-section" id="pageHeader">
  <div style="display:flex;align-items:center;gap:16px">
    <img alt="Christy Signs" src="/skyesoft/assets/images/christyLogo.png" style="max-height:48px">
    <h1 style="font-size:1.4em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">Office Bulletin Board</h1>
  </div>
  <div style="display:flex;flex-direction:column;align-items:flex-end;font-size:0.9em;white-space:nowrap">
    <div>Weather: <span id="weatherDisplay">Loading...</span></div>
    <div>Time: <div>Time: <span id="currentTime">--:--</span><span id="secondsDisplay" style="font-weight:normal">:--</span></div>
    <div>Interval: <span id="intervalRemainingData">Loading...</span></div>
  </div>
</div>

<div class="board-section" id="pageBody">
  <div class="bodyHeader" id="bodyHeader"></div>
  <div id="bodyMain"></div>
  <div class="bodyFooter" id="bodyFooter"></div>
</div>

<div class="board-section" id="pageFooter">
  <div>¬© 2025 Maychris Corporation</div>
  <div class="version">v3.3.1 ‚Äì Enhanced Interval UX + Live Seconds</div>
</div>

<script>
// ===================================================================
// LIVE DATA + SECOND-BY-SECOND COUNTDOWN
// ===================================================================
let serverData = null;

function loadLiveData() {
  fetch("/skyesoft/api/getDynamicData.php")
    .then(r => r.json())
    .then(d => {
      serverData = d;

      if (d.timeDateArray?.currentLocalTimeShort) {
        document.getElementById("currentTime").textContent = d.timeDateArray.currentLocalTimeShort;
      }

      if (d.weatherData) {
        const w = d.weatherData;
        const icons = {"01":"‚òÄÔ∏è","02":"üå§Ô∏è","03":"‚õÖ","04":"‚òÅÔ∏è","09":"üå¶Ô∏è","10":"üåßÔ∏è","11":"‚õàÔ∏è","13":"‚ùÑÔ∏è","50":"üå´Ô∏è"};
        const emoji = icons[w.icon?.substr(0,2)] || "üå§Ô∏è";
        document.getElementById("weatherDisplay").textContent = `${emoji} ${w.temp}¬∞F ‚Äî ${w.description}`;

        document.getElementById("sunriseTime").textContent   = w.sunrise;
        document.getElementById("sunsetTime").textContent    = w.sunset;
        document.getElementById("daylightTime").textContent  = w.daytimeHours;
        document.getElementById("nightTime").textContent     = w.nighttimeHours;

        if (Array.isArray(w.forecast)) {
          w.forecast.slice(0,3).forEach((day,i) => {
            const el = document.getElementById("forecastDay"+(i+1));
            if (el) {
              const emoji = icons[day.icon?.substr(0,2)] || "üå§Ô∏è";
              const desc = day.description.charAt(0).toUpperCase() + day.description.slice(1);
              el.innerHTML = `<strong>üìÖ ${day.date}</strong><br>${emoji} ${desc}<br>High ${day.high}¬∞F / Low ${day.low}¬∞F | üíß ${day.precip}% | üí® ${day.wind} mph`;
            }
          });
        }
      }

      if (d.holidays) {
        const today = new Date(); today.setHours(0,0,0,0);
        let closest = Infinity, name = "";
        for (let ds in d.holidays) {
          const hd = new Date(ds);
          if (hd >= today) {
            const diff = Math.ceil((hd - today) / 86400000);
            if (diff < closest) { closest = diff; name = d.holidays[ds]; }
          }
        }
        if (name) document.getElementById("nextHoliday").textContent = `${name} ‚Äî in ${closest} day${closest>1?"s":""}`;
      }

      updateCountdown();
    })
    .catch(() => {});
}

function updateCountdown() {
  if (!serverData?.intervalsArray) return;

  const i = serverData.intervalsArray;
  let sec = Math.max(0, i.secondsRemainingToInterval);

  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;

  const el = document.getElementById("intervalRemainingData");
  if (!el) return;

  const isWorkday = (i.dayType === "Workday");

  let label = "";
  let emoji = "";

  if (!isWorkday) {
    label = "Office closed";
    emoji = "üü¶";
  }
  else if (i.intervalName === "Worktime") {
    label = "Workday ends in";
    emoji = "üü©";
  }
  else if (i.intervalName === "Before Worktime") {
    label = "Workday begins in";
    emoji = "üü®";
  }
  else if (i.intervalName === "After Worktime") {
    label = "Workday resumes tomorrow";
    emoji = "üî¥";
  }

  let timeText = "";
  if (label.includes("in")) {
    if (h > 0) timeText += `${h}h `;
    timeText += `${m}m ${s}s`;
  }

  el.textContent = label.includes("in")
    ? `${emoji} ${label} ${timeText}`
    : `${emoji} ${label}`;

  // Visual cue when close to transition
  if (i.intervalName === "Worktime" && sec <= 600) {
    el.style.color = (sec <= 30 && sec % 2 === 0) ? "red" : "goldenrod";
  } else {
    el.style.color = "#000";
  }

  // Tick down
  serverData.intervalsArray.secondsRemainingToInterval = sec - 1;
}

loadLiveData();
setInterval(loadLiveData, 15000);
setInterval(updateCountdown, 1000);
updateCountdown();

// ===================================================================
// CARDS + ROTATION (unchanged)
// ===================================================================
const cards = [ /* your 4 cards with all 23 permit rows ‚Äì unchanged */ ];

let cardIndex = 0;
function populateCard(c) {
  document.getElementById("bodyHeader").innerHTML = c.header;
  document.getElementById("bodyMain").innerHTML = `<div class="cardBody">${c.body}</div>`;
  document.getElementById("bodyFooter").innerHTML = c.footer;
}
function getLiveDateInfo() {
  const n = new Date();
  const f = n.toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric'});
  const y = n.getFullYear();
  const leap = (y%4===0 && (y%100!==0 || y%400===0)) ? 366 : 365;
  const doy = Math.floor((n - new Date(y,0,0)) / 86400000);
  return {formattedDate: f, dayOfYear: doy, daysRemaining: leap - doy};
}
function updateHighlightsCard() {
  const d = getLiveDateInfo();
  document.getElementById("todaysDate").textContent = d.formattedDate;
  document.getElementById("dayOfYear").textContent = d.dayOfYear;
  document.getElementById("daysRemaining").textContent = d.daysRemaining;
  const tip = document.getElementById("tipOfTheDay");
  if (tip) tip.textContent = "üí° Tip of the Day: ‚ÄúStay awesome!‚Äù";
}
function autoScrollCardBody() {
  const c = document.querySelector(".cardBody");
  if (!c) return;
  c.scrollTop = 0;
  const dist = c.scrollHeight - c.clientHeight;
  if (dist <= 0) return;
  let pos = 0;
  const timer = setInterval(() => {
    pos += 1.5;
    c.scrollTop = pos;
    if (pos >= dist) clearInterval(timer);
  }, 30);
}
function rotateCards() {
  const card = cards[cardIndex];
  populateCard(card);
  if (cardIndex === 0) setTimeout(autoScrollCardBody, 500);
  if (cardIndex === 1) setTimeout(updateHighlightsCard, 50);
  cardIndex = (cardIndex + 1) % cards.length;
  setTimeout(rotateCards, card.duration);
}

// LIVE SECONDS WITH BLINKING COLON
function updateSeconds() {
  const now = new Date();
  const secs = now.getSeconds().toString().padStart(2, '0');
  const secondsEl = document.getElementById("secondsDisplay");
  if (secondsEl) {
    secondsEl.textContent = `:${secs}`;
    secondsEl.style.opacity = (secs % 2 === 0) ? "1" : "0.3";  // subtle blink
  }
}

// Start everything
window.addEventListener("DOMContentLoaded", () => {
  rotateCards();
  updateSeconds();          // immediate seconds on load
  setInterval(updateSeconds, 1000);  // every second
});

setInterval(updateSeconds, 1000);
updateSeconds();  // immediate
</script>
</body>
</html>