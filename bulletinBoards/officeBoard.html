<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Office Bulletin Board</title>
<link rel="icon" href="/skyesoft/assets/images/favicon.ico" type="image/x-icon">
<style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100vh;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:url('/skyesoft/assets/images/background.jpg') no-repeat center center fixed;background-size:cover;display:flex;flex-direction:column;align-items:center}
    .board-section{width:90vw;max-width:1200px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);padding:8px 16px}
    #pageHeader,#pageFooter{flex-shrink:0}
    #pageBody{flex-grow:1;display:flex;flex-direction:column;justify-content:space-between;margin:12px 0;max-height:calc(100vh - 160px);overflow:hidden}
    #pageHeader{display:flex;justify-content:space-between;align-items:center;font-size:1.1em;margin-top:12px}
    #bodyHeader,#bodyFooter{font-weight:bold;font-size:1em;text-align:left;margin-bottom:8px}
    #bodyMain{flex-grow:1;display:flex;flex-direction:column;justify-content:flex-start;overflow:hidden;margin-top:-4px}
    .entry{margin:6px 0;font-size:1.05em}
    #pageFooter{display:flex;justify-content:space-between;align-items:center;font-size:0.8em;padding:6px 12px;background:#fff;margin-bottom:12px}
    .cardBody{overflow-y:auto;max-height:60vh;flex-grow:1;padding-top:0;margin-top:0}
    .bodyHeader::after{content:"";display:block;height:2px;width:100%;background:#ccc;margin-top:6px}
    .bodyFooter::before{content:"";display:block;height:2px;width:100%;background:#ccc;margin-bottom:6px}
    .version{font-size:0.8em;color:#777}
    .forecastRow{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .forecastItem{flex:1;font-size:0.8rem;min-width:200px;background:#f9f9f9;padding:10px;border-radius:8px;margin:4px 0}
    .permitCard{max-height:500px;overflow:hidden;width:100%}
    .scrollContainer{max-height:400px;overflow-y:auto;position:relative;width:100%}
    .permitTable{width:100%;border-collapse:collapse;table-layout:auto}
    .permitTable thead{position:sticky;top:0;background:#004080;color:#fff;z-index:2}
    .permitTable th,.permitTable td{padding:6px 8px;border-bottom:1px solid #ddd;text-align:left}
    .permitTable tr:nth-child(even){background:#f2f2f2}
    .status-ready{color:green;font-weight:bold}
    .status-review{color:orange;font-weight:bold}
</style>
</head>
<body>
<div class="board-section" id="pageHeader">
  <div style="display:flex;align-items:center;gap:16px">
    <img alt="Christy Signs" src="/skyesoft/assets/images/christyLogo.png" style="max-height:48px">
    <h1 style="font-size:1.4em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">Office Bulletin Board</h1>
  </div>
  <div style="display:flex;flex-direction:column;align-items:flex-end;font-size:0.9em;white-space:nowrap">
    <div>Weather: <span id="weatherDisplay">Loading...</span></div>
    <div>Time: <span id="currentTime">--:--:--</span></div>
    <div>Interval: <span id="intervalRemainingData">Loading...</span></div>
  </div>
</div>

<div class="board-section" id="pageBody">
  <div class="bodyHeader" id="bodyHeader"></div>
  <div id="bodyMain"></div>
  <div class="bodyFooter" id="bodyFooter"></div>
</div>

<div class="board-section" id="pageFooter">
  <div>¬© 2025 Maychris Corporation</div>
  <div class="version">v8.0 ‚Äì Fully Working Again</div>
</div>

<script>
// ===================================================================
// LIVE DATA + SYNCED CLOCK & COUNTDOWN
// ===================================================================
let serverData = null;
let serverTimeOffset = 0;

function loadLiveData() {
  fetch("/skyesoft/api/getDynamicData.php")
    .then(r => r.json())
    .then(d => {
      serverData = d;
      if (d.timeDateArray?.currentUnixTime) {
        serverTimeOffset = (d.timeDateArray.currentUnixTime * 1000) - Date.now();
      }
      updateClockAndCountdown();
      // Weather + Highlights + Holiday
      if (d.weatherData) {
        const w = d.weatherData;
        const icons = {"01":"‚òÄÔ∏è","02":"üå§Ô∏è","03":"‚õÖ","04":"‚òÅÔ∏è","09":"üå¶Ô∏è","10":"üåßÔ∏è","11":"‚õàÔ∏è","13":"‚ùÑÔ∏è","50":"üå´Ô∏è"};
        const emoji = icons[w.icon?.substr(0,2)] || "üå§Ô∏è";
        document.getElementById("weatherDisplay").textContent = `${emoji} ${w.temp}¬∞F ‚Äî ${w.description}`;
        document.getElementById("sunriseTime").textContent = w.sunrise;
        document.getElementById("sunsetTime").textContent = w.sunset;
        document.getElementById("daylightTime").textContent = w.daytimeHours;
        document.getElementById("nightTime").textContent = w.nighttimeHours;
        if (Array.isArray(w.forecast)) {
          w.forecast.slice(0,3).forEach((day,i) => {
            const el = document.getElementById("forecastDay"+(i+1));
            if (el) {
              const emoji = icons[day.icon?.substr(0,2)] || "üå§Ô∏è";
              const desc = day.description.charAt(0).toUpperCase() + day.description.slice(1);
              el.innerHTML = `<strong>üìÖ ${day.date}</strong><br>${emoji} ${desc}<br>High ${day.high}¬∞F / Low ${day.low}¬∞F | üíß ${day.precip}% | üí® ${day.wind} mph`;
            }
          });
        }
      }
      if (d.holidays) {
        const today = new Date(); today.setHours(0,0,0,0);
        let closest = Infinity, name = "";
        for (let ds in d.holidays) {
          const hd = new Date(ds);
          if (hd >= today) {
            const diff = Math.ceil((hd - today) / 86400000);
            if (diff < closest) { closest = diff; name = d.holidays[ds]; }
          }
        }
        if (name) document.getElementById("nextHoliday").textContent = `${name} ‚Äî in ${closest} day${closest>1?"s":""}`;
      }
    })
    .catch(() => {});
}

function updateClockAndCountdown() {
  if (!serverData) return;
  const serverNow = new Date(Date.now() + serverTimeOffset);
  const h = serverNow.getHours();
  const m = serverNow.getMinutes().toString().padStart(2, '0');
  const s = serverNow.getSeconds().toString().padStart(2, '0');
  const ampm = h >= 12 ? 'PM' : 'AM';
  document.getElementById("currentTime").textContent = `${(h % 12) || 12}:${m}:${s} ${ampm}`;

  if (serverData.intervalsArray) {
    let sec = Math.max(0, serverData.intervalsArray.secondsRemainingToInterval);
    const hh = Math.floor(sec / 3600).toString().padStart(2, '0');
    const mm = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
    const ss = (sec % 60).toString().padStart(2, '0');

    const i = serverData.intervalsArray;
    const isWorkday = (i.dayType === "Workday");

    let label = "";
    let emoji = "";

    if (!isWorkday) {
      label = "Office closed";
      emoji = "üü¶";
    } else if (i.intervalName === "Worktime") {
      label = "Workday ends in";
      emoji = "üü©";
    } else if (i.intervalName === "Before Worktime") {
      label = "Workday begins in";
      emoji = "üü®";
    } else {
      label = "Workday resumes tomorrow";
      emoji = "üî¥";
    }

    let timeText = "";
    if (label.includes("in")) {
      timeText = `${hh}h ${mm}m ${ss}s`;
    }

    document.getElementById("intervalRemainingData").textContent = label.includes("in")
      ? `${emoji} ${label} ${timeText}`
      : `${emoji} ${label}`;

    if (i.intervalName === "Worktime" && sec <= 600) {
      document.getElementById("intervalRemainingData").style.color = (sec <= 30) ? "red" : "goldenrod";
    } else {
      document.getElementById("intervalRemainingData").style.color = "#000";
    }

    serverData.intervalsArray.secondsRemainingToInterval = sec - 1;
  }
}

loadLiveData();
setInterval(loadLiveData, 15000);
setInterval(updateClockAndCountdown, 1000);
updateClockAndCountdown();

// ===================================================================
// CARDS + ROTATION + FIXED SCROLL
// ===================================================================
const cards = [
  {header:"<h2>üìã Active Permits</h2>",body:`<div class="permitCard"><div class="scrollContainer"><table class="permitTable"><thead><tr><th>WO #</th><th>Customer</th><th>Jobsite</th><th>Jurisdiction</th><th>Fee</th><th>Status</th></tr></thead><tbody>
    <tr><td>26312</td><td>Sun Valley Wellness</td><td>Sun Valley Wellness</td><td>Scottsdale</td><td>$545.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26036</td><td>Switch Electric</td><td>Switch Electric</td><td>Tempe</td><td>$356.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>25674</td><td>Printing Solutions</td><td>Ten Figures</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26335</td><td>U-Haul</td><td>U-Haul (Grand/Bell Rd)</td><td>Surprise</td><td>$154.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26513</td><td>Penchetta Pen & Knife</td><td>Penchetta Pen & Knife</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26216</td><td>Walton Signage</td><td>Bank Of America</td><td>Avondale</td><td>$470.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26630</td><td>Signtech</td><td>Williams Sonoma</td><td>Scottsdale</td><td>$620.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26585</td><td>NRS</td><td>NRS</td><td>Casa Grande</td><td>$254.77</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26606</td><td>Allen Industries, Inc</td><td>Verizon BeMobile</td><td>Goodyear</td><td>$388.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>24741</td><td>Arizona Partners</td><td>Arrowhead Marketplace</td><td>Glendale</td><td>$844.93</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26111</td><td>Identity Sign Builders</td><td>Ferguson</td><td>Scottsdale</td><td>$570.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26927</td><td>Omaha Neon Sign</td><td>Blue Sushi Sake Grill</td><td>Tempe</td><td>$368.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26694</td><td>Gudeng Inc</td><td>Gudeng Inc</td><td>Glendale</td><td>$200.11</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26836</td><td>Yaho</td><td>Yaho</td><td>Glendale</td><td>$200.11</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26877</td><td>Identity Sign Builders</td><td>Ferguson</td><td>Glendale</td><td>$400.22</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26337</td><td>U-Haul</td><td>U-Haul # 00000</td><td>Queen Creek</td><td>$664.60</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26545</td><td>Walton Signage</td><td>Bank Of America</td><td>Scottsdale</td><td>$900.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>25523</td><td>Printing Solutions</td><td>Roosevelt Lake Marina</td><td>Roosevelt Lake</td><td>$699.75</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27071</td><td>Pattison Sign Group</td><td>Stotz Equipment</td><td>Chandler</td><td>$76.68</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27031</td><td>Entera Branding</td><td>Mellow Mushroom #144</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27051</td><td>Sign Resource</td><td>Safeway #209</td><td>Queen Creek</td><td>$414.60</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>26889</td><td>Sign Resource</td><td>Bank Of America #AZW-297</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27137</td><td>Everbright</td><td>Habit Burger #53529</td><td>Laveen</td><td>$150.00</td><td class="status-review">Ready To Review</td></tr>
    <tr><td>27141</td><td>Everbright</td><td>Habit Burger #53527</td><td>Phoenix</td><td>$450.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27142</td><td>Everbright</td><td>Habit Burger #53530</td><td>Phoenix</td><td>$375.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27140</td><td>Everbright</td><td>Habit Burger #53524</td><td>Phoenix</td><td>$450.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27139</td><td>Everbright</td><td>Habit Burger #53510</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27144</td><td>Everbright</td><td>Sherwin Williams #708000</td><td>Mesa</td><td>$101.23</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27135</td><td>Everbright</td><td>Habit Burger #53508</td><td>Tempe</td><td>$647.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27104</td><td>Holiday Inn Express</td><td>Holiday Inn Express</td><td>Tempe</td><td>$368.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27316</td><td>Everbright</td><td>Dunkin Avondale</td><td>Avondale</td><td>$826.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27199</td><td>First Rate Staffing</td><td>First Rate Staffing</td><td>Phoenix</td><td>$225.00</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27380</td><td>National Sign & Marketing</td><td>Chick Fil A</td><td>Glendale</td><td>$200.11</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27170</td><td>Everbright</td><td>Great Clips #1554</td><td>Phoenix</td><td>$225.00</td><td class="status-review">Ready To Review</td></tr>
    <tr><td>27169</td><td>Everbright</td><td>Great Clips #6336</td><td>Phoenix</td><td>$225.00</td><td class="status-review">Ready To Review</td></tr>
    <tr><td>27171</td><td>Everbright</td><td>Great Clips #1525</td><td>Phoenix</td><td>$225.00</td><td class="status-review">Ready To Review</td></tr>
    <tr><td>27409</td><td>Vetra of Chandler</td><td>Vetra of Chandler</td><td>Chandler</td><td>$373.19</td><td class="status-ready">Ready To Issue</td></tr>
    <tr><td>27154</td><td>Everbright</td><td>State Farm - Severiano Torres</td><td>Buckeye</td><td>$660.41</td><td class="status-ready">Ready To Issue</td></tr>
  </tbody></table></div></div>`,footer:"<small>Updated: 2025-11-19</small>",duration:30000},
  {header:"<h2>üåÖ Today‚Äôs Highlights</h2>",body:`
    <div class="entry">üìÖ <span id="todaysDate"></span> ¬∑ Day <span id="dayOfYear"></span> of 365 (<span id="daysRemaining"></span> remaining)</div>
    <div class="entry">üåÑ Sunrise: <span id="sunriseTime">--:--</span> ¬∑ üåá Sunset: <span id="sunsetTime">--:--</span></div>
    <div class="entry">üïí Daylight: <span id="daylightTime">-- hrs</span> ¬∑ üåå Night: <span id="nightTime">-- hrs</span></div>
    <div class="entry">Next Holiday: <span id="nextHoliday">Loading...</span></div>
    <hr style="margin:12px 0;border:none;border-top:1px solid #ccc">
    <div class="entry" id="tipOfTheDay">üí° Tip of the Day: Loading...</div>
    <div class="entry">Birthdays Today: (none)</div>
    <div class="entry">Anniversary: Mark ‚Äì 3 Years!</div>
    <hr style="margin:12px 0;border:none;border-top:1px solid #ccc">
    <div class="entry forecastRow">
      <div class="forecastItem"><span id="forecastDay1">Loading...</span></div>
      <div class="forecastItem"><span id="forecastDay2">Loading...</span></div>
      <div class="forecastItem"><span id="forecastDay3">Loading...</span></div>
    </div>`,footer:"<small>Live Data</small>",duration:30000},
  {header:"<h2>üìà KPI Dashboard</h2>",body:`<div class="entry">Coming Soon‚Ä¶</div>`,footer:"<small>Updated Daily</small>",duration:30000},
  {header:"<h2>üì¢ Announcements</h2>",body:`<div class="entry">No announcements posted.</div>`,footer:"<small>Company-Wide</small>",duration:30000}
];

let cardIndex = 0;
function populateCard(c){
  document.getElementById("bodyHeader").innerHTML=c.header;
  document.getElementById("bodyMain").innerHTML=`<div class="cardBody">${c.body}</div>`;
  document.getElementById("bodyFooter").innerHTML=c.footer;
}
function getLiveDateInfo(){
  const n=new Date();
  const f=n.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  const y=n.getFullYear();
  const leap=(y%4===0&&(y%100!==0||y%400===0))?366:365;
  const doy=Math.floor((n-new Date(y,0,0))/86400000);
  return{formattedDate:f,dayOfYear:doy,daysRemaining:leap-doy};
}
function updateHighlightsCard(){
  const d=getLiveDateInfo();
  document.getElementById("todaysDate").textContent=d.formattedDate;
  document.getElementById("dayOfYear").textContent=d.dayOfYear;
  document.getElementById("daysRemaining").textContent=d.daysRemaining;
}
function autoScrollCardBody(){
  const c=document.querySelector(".scrollContainer");
  if(!c)return;
  c.scrollTop=0;
  const dist=c.scrollHeight-c.clientHeight;
  if(dist<=0)return;
  let pos=0;
  const timer=setInterval(()=>{pos+=1.5;c.scrollTop=pos;if(pos>=dist)clearInterval(timer);},30);
}
function rotateCards(){
  const c=cards[cardIndex];
  populateCard(c);
  if(cardIndex===0)setTimeout(autoScrollCardBody,500);
  if(cardIndex===1)setTimeout(updateHighlightsCard,50);
  cardIndex=(cardIndex+1)%cards.length;
  setTimeout(rotateCards,c.duration);
}
window.addEventListener("DOMContentLoaded",rotateCards);
</script>
</body>
</html>