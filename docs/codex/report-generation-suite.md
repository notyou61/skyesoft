# üìë Report Generation Suite

## üéØ Purpose  
Provide a standardized framework for creating, validating, and rendering reports across Skyesoft, using CRUD JSON, AI templates, and automation hooks. Ensures consistency in headers, body, and footers while supporting both standardized and custom reports.

## üìå Key Features  
- Dynamic CRUD JSON generation via Skyebot prompts  
- Validation of required fields against `report_types.json`  
- Conditional auto-fill from APIs (parcel, jurisdiction, etc.)  
- Standardized templates for zoning, sign ordinance, photo survey, etc.  
- Custom/freeform report option for ad-hoc needs  

## ‚öôÔ∏è Workflow  
1. **Prompt** ‚Üí Skyebot determines `reportType` via CRUD JSON  
2. **Validation** ‚Üí Required fields checked from `report_types.json`  
3. **Auto-fill** ‚Üí Pull missing fields from APIs (parcel, SSE, codex)  
4. **Template Merge** ‚Üí Apply header, body, footer per `reportType`  
5. **Render** ‚Üí Output as HTML/PDF with Christy Signs branding  

---

## üìä Report Types (Detailed Specs)

### üü¢ Zoning Report  
**Purpose**: Verify zoning status for a project site.  

**Required Fields**:  
- Mandatory: `streetNumber`, `zip`  
- Optional: `city`, `county`, `parcelId`  

**Pipeline**:  
1. Geocode via Census *(authoritative address normalization; returns FIPS + WGS84 lat/lon; fallback Google if Census fails)*  
2. Lookup parcel via Assessor API *(normalized address/ZIP; relaxed + fuzzy matching supported)*  
3. Retrieve jurisdiction + geometry *(jurisdiction determines zoning service endpoint; geometry provides polygon/centroid for spatial queries)*  
4. Perform zoning lookup *(jurisdiction-specific ArcGIS endpoint; reproject coordinates if required, e.g., EPSG:4326 ‚Üí Web Mercator)*  
5. Return zoning code + attributes *(attach context-sensitive disclaimers)*  

**Outputs**:  
- address  
- matchedAddress  
- county, FIPS  
- apn, situs, jurisdiction  
- zoningCodes  
- disclaimers  

**Edge Cases**:  
- Multiple parcels ‚Üí flag as `multipleParcels`  
- No geometry ‚Üí fallback to geocode centroid  
- multiParcelSite ‚Üí group APNs into one site if zoning is identical  
- mixedParcelZoning ‚Üí show parcels separately + disclaimer if zoning differs  

**Known Issues**:  
- **Mailing vs Situs Mismatch**  
  - *Example:* 50 E Civic Center Dr, Gilbert AZ 85296  
  - *Issue:* Address is mailing only, not situs; pipeline may return multiple fuzzy parcels.  
  - *Fix:* Detect mailing vs situs, cross-reference APN (e.g., 304-24-991 ‚Üí 90 E Civic Center Dr).  
  - *Disclaimer:* ‚ö†Ô∏è Mailing address detected ‚Äî corrected to situs parcel.

- **Scottsdale Zoning Null**  
  - *Example:* 7014 E Camelback Rd, Scottsdale AZ 85251  
  - *Issue:* APNs matched correctly but zoning returns null.  
  - *Fix:* Add ArcGIS zoning lookup for Scottsdale, fallback disclaimer if unavailable.  
  - *Disclaimer:* ‚ö†Ô∏è Scottsdale zoning service unavailable ‚Äî verify directly with jurisdiction.

---

### üü° Sign Ordinance Report  
**Purpose**: Summarize applicable sign regulations for a site.  

**Required Fields**:  
- Mandatory: `address`  
- Optional: `jurisdiction`, `parcelId`  

**Pipeline**:  
1. Geocode + jurisdiction detection *(normalize address, detect governing body; fallback to provided jurisdiction if unavailable)*  
2. Query local sign code references *(municipal code DB, PDFs, or jurisdiction API)*  
3. Return regulations summary *(rules on size, height, lighting, materials; include source citations where available)*  

**Outputs**:  
- jurisdiction  
- signCodeSummary  
- linksToMunicipalCode  

**Edge Cases**:  
- Jurisdiction code unavailable ‚Üí return `unsupportedJurisdiction`  

---

### üü° Photo Survey Report  
**Purpose**: Collect and display site survey photos with context.  

**Required Fields**:  
- Mandatory: `address`, `photos`  
- Optional: `notes`  

**Pipeline**:  
1. Validate uploaded images *(check type, size, and metadata)*  
2. Tag photos with GPS/time *(ensure chain of custody; preserve EXIF or system timestamp)*  
3. Generate structured report with captions *(organize photos + notes)*  

**Outputs**:  
- photoArray  
- captions  
- surveyNotes  

**Edge Cases**:  
- No photos provided ‚Üí return `missingPhotos`  

---

### üü¢ Custom Report  
**Purpose**: Freeform narrative or ad-hoc report generated by AI.  

**Required Fields**:  
- Mandatory: `details`  
- Optional: `title`, `context`  

**Pipeline**:  
1. Parse freeform details from prompt *(clean and normalize user text, drop filler keywords)*  
2. Generate structured narrative *(compose header, body, footer using AI template)*  
3. Return JSON + HTML/PDF with disclaimers *(flag as AI-generated; requires human verification)*  

**Outputs**:  
- reportBody  
- disclaimers  

**Edge Cases**:  
- Empty details ‚Üí request clarification  

---

## üß† Smart Behaviors  
- Infers context from prompt to auto-choose reportType  
- Requests clarification if multiple types are possible  
- Normalizes project identifiers (e.g., projectName vs. jobsiteName)  
- Preserves extra user-provided fields without filtering  

## üîå Integration Points  
- Core Database (entities, locations, contacts)  
- Permit Management Suite  
- Mobile-First Modals  
- Skyebot AI Engine  

## üèÅ Example Report Request  
```json
{
  "actionType": "Create",
  "actionName": "Report",
  "details": {
    "reportType": "zoning",
    "title": "Zoning Report ‚Äì Christy Signs HQ",
    "data": {
      "projectName": "Christy Signs HQ",
      "address": "3145 N 33rd Ave, Phoenix, AZ 85017",
      "parcel": "108-03-009E",
      "jurisdiction": "Phoenix"
    }
  }
}
```